<!DOCTYPE html>

<html lang="en">
    <head>
        <meta name="viewport" content="initial-scale=1 width=device-width">
        <link href="static/bootstrap.min.css" rel="stylesheet">
        <script src="static/bootstrap.bundle.min.js"></script>
        <script src="static/chart.js"></script>
        <link rel="icon" href="static/favicon.png" type="image/x-icon">
        <title>AirSense</title>
        <style>
          .table-transparent {
            --bs-table-bg: transparent !important;
          }
          .unit{
          color:black;
          font-size: 0.75em;
          }
          .scroll{
          width: 95%;
          height: 74vh;
          overflow-y: auto;
          overflow-x: hidden;
          padding: 0px;
          margin:0;
          border: 0px solid #ccc;
          margin: 0;
          margin: 0;
          position: absolute;
          left: 50%;
          transform: translate(-50%);
          }
          #header{
          color:black;
          font-size: 4vh;
          }
          #footer{
          color:black;
          font-size: 2vh;
          }
          #small{
          color:black;
          font-size: 2vh;
          }
          body{
          color:black;
          font-size: 1.6vh;
          }
        </style>
    </head>
    <body>
        <div class="container-fluid position-absolute top-50 start-50 translate-middle" style="border: 0px solid red; height: 95vh; width:98vw;">
            <div class="container-fluid bg-warning position-absolute top-0 start-50 translate-middle-x shadow-lg rounded my-1 mx-0 text-center" style="height: 8vh; width:95%">
                <span Style="vertical-align: middle;line-height: 8vh;" id="header">AirSense</span>
            </div>

            <div class="container-fluid bg-warning position-absolute top-50 start-50 translate-middle shadow-lg rounded" style="height: 75vh; width:95%">

              <div id="carouselDark" class="carousel carousel-dark slide">
                <div class="carousel-inner px-0 position-center" style="height:85vh" >

                  <div class="carousel-indicators m-3 w-100">
                    <button type="button" data-bs-target="#carouselDark" data-bs-slide-to="0" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carouselDark" data-bs-slide-to="1" class="active" aria-current="true" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselDark" data-bs-slide-to="2" aria-label="Slide 3"></button>
                    <button type="button" data-bs-target="#carouselDark" data-bs-slide-to="3" aria-label="Slide 4"></button>
                    <button type="button" data-bs-target="#carouselDark" data-bs-slide-to="4" aria-label="Slide 5"></button>
                    <button type="button" data-bs-target="#carouselDark" data-bs-slide-to="5" aria-label="Slide 6"></button>
                    <button type="button" data-bs-target="#carouselDark" data-bs-slide-to="6" aria-label="Slide 7"></button>
                    <button type="button" data-bs-target="#carouselDark" data-bs-slide-to="7" aria-label="Slide 8"></button>
                  </div>

                  <div class="container-fluid">
                    <div class="carousel-item">
                      <div class="mb-4 position-center top-50 start-50 scroll">
                        <div class="container-fluid" style="height: 70vh; width: 80vw;">
                          <h5 class="text-center" id="small">Settings</h5><br><br>
                          <table class="table table-transparent mx-auto h-50 text-start">
                            <tbody>
                              <tr>
                                <form action="/" method="POST">
                              <th scope="row">1</th>
                              <td>Unit</td>
                              <td>
                                <select class="form-select form-select-sm" aria-label="Default select example" name="tempUnit">
                                <option selected disabled>Unit</option>
                                <option value="C">&deg;C</option>
                                <option value="F">&deg;F</option>
                              </select>
                            </td>
                            </tr>
                            <tr>
                              <th scope="row">2</th>
                              <td>Display Timeout</td>
                              <td>
                                <select class="form-select form-select-sm" aria-label="Default select example" name="displayTimeout">
                                <option selected disabled value="2">Display Timeout</option>
                                <option value="1">30 sec (Default)</option>
                                <option value="0">Always on</option>
                              </select></td>
                            </tr>
                            <tr>
                              <th scope="row">3</th>
                              <td>Screen Orientation</td>
                              <td>
                                <select class="form-select form-select-sm" aria-label="Default select example" name="displayOrientation">
                                <option selected disabled>Screen Orientation</option>
                                <option value="0">1</option>
                                <option value="1">2</option>
                                <option value="2">3</option>
                                <option value="3">4</option>
                              </select></td>
                            </tr>
                            <tr>
                                <th scope="row">4</th>
                                <td>LED</td>
                                <td>
                                  <select class="form-select form-select-sm" aria-label="Default select example" name="Led">
                                  <option selected disabled>LED</option>
                                  <option value="1">On</option>
                                  <option value="0">Off</option>
                                </select></td>
                              </tr>
                              <tr>
                                <th scope="row">5</th>
                                <td>Wlan SSID</td>
                                <td>
                                  <input class="form-input form-input-sm" aria-label="Default input example" id="ssid" name="ssid" minl/></td>
                              </tr>
                              <tr>
                                <th scope="row">6</th>
                                <td>Wlan Password</td>
                                <td>
                                  <input class="form-input form-input-sm" aria-label="Default input example" type="password" id="pass" name="password" minl/>
                                </td>
                              </tr>
                              <tr>
                                <th scope="row">7</th>
                                <td>MQTT</td>
                                <td>
                                    <input class="form-control form-control-sm" type="text" placeholder=".form-control-sm" aria-label=".form-control-sm example">
                                </td>
                              </tr>
                            <tr>
                            <tr>
                                <th scope="row">8</th>
                                <td>MQTT</td>
                                <td>
                                    <input class="form-control form-control-sm" type="text" placeholder=".form-control-sm" aria-label=".form-control-sm example">
                                </td>
                                </tr>
                                <tr>
                                <th scope="row">9</th>
                                <td>MQTT</td>
                                <td>
                                    <input class="form-control form-control-sm" type="text" placeholder=".form-control-sm" aria-label=".form-control-sm example">
                                </td>
                                </tr>
                            <tr>
                              <th scope="row">10</th>
                              <td></td>
                              <td><span id="h">-</span></td>
                            </tr>
                            <tr>
                              <th scope="row">11</th>
                              <td><a href="/restapi">Rest API</a> | <a href="/restapi">Connected (IP)</a></td>
                              <td><span id="h">LCD OK | BME OK | SCD OK</span></td>
                            </tr>
                            <tr>
                              <th scope="row">12</th>
                              <td><button type="submit" class="btn btn-sm btn-success">Save</button></form></td>
                              <td><button onclick="fetch('/reset')" type="button" class="btn btn-sm btn-danger">Reboot</button>
                                  <button onclick="fetch('/freset')" type="button" class="btn btn-sm btn-danger">Factory Reset</button></td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>


                    <div class="carousel-item active">
                      <div class="mb-4 position-center top-50 start-50 scroll">
                        <div class="container-fluid" style="height: 70vh; width: 79vw;">
                          <h5 class="text-center" id="small">Live</h5><br><br>
                          <table class="table table-transparent mx-auto h-75 text-start">
                            <tbody>
                              <tr>
                                <th scope="row">1</th>
                                <td>Temperature (SCD30)</td>
                                <td><span id="temperatureScd">-</span><span class="unit">&deg;</span><span class="unit" id="tempUnitScd"></span></td>
                              </tr>
                              <tr>
                                <th scope="row">2</th>
                                <td>Temperature (BME680)</td>
                                <td><span id="temperatureBme">-</span><span class="unit">&deg;</span><span class="unit" id="tempUnitBme"></span></td>
                              </tr>
                              <tr>
                                <th scope="row">3</th>
                                <td>Humidity (SCD30)</td>
                                <td><span id="humidityScd">-</span><span class="unit">%rel</span></td>
                              </tr>
                              <tr>
                                <th scope="row">4</th>
                                <td>Humidity (BME680)</td>
                                <td><span id="humidityBme">-</span><span class="unit">%rel</span></td>
                              </tr>
                              <tr>
                                <th scope="row">5</th>
                                <td>CO2</td>
                                <td><span id="co2">-</span><span class="unit"> ppm</span></td>
                              </tr>
                              <tr>
                                <th scope="row">6</th>
                                <td>Pressure</td>
                                <td><span id="pressure">-</span><span class="unit"> hPa</span></td>
                              </tr>
                              <tr>
                                <th scope="row">7</th>
                                <td>VOC</td>
                                <td><span id="voc">-</span><span class="unit"> ohm</span></td>
                              </tr>
                              <tr>
                                <th scope="row">8</th>
                                <td>PM1.0</td>
                                <td><span id="pm10">-</span><span class="unit">&#181;g/m&#179;</span></td>
                              </tr>
                              <tr>
                                <th scope="row">9</th>
                                <td>PM2.5</td>
                                <td><span id="pm25">-</span><span class="unit">&#181;g/m&#179;</span></td>
                              </tr>
                              <tr>
                                <th scope="row">10</th>
                                <td>PM10</td>
                                <td><span id="pm100">-</span><span class="unit">&#181;g/m&#179;</span></td>
                              </tr>
                              <tr>
                                <th scope="row">11</th>
                                <td>Status</td>
                                <td><span id="connection" class="unit">-</span></td>
                                <tr>
                                  <th scope="row">12</th>
                                  <td>Uptime</td>
                                  <td><span id="uptime">-</span><span class="unit"> min</span></td>
                                </tr>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>




                </div></div>
                <button class="carousel-control-prev opacity-75" type="button" data-bs-target="#carouselDark" data-bs-slide="prev" style="width: 5vw; height: 75vh">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next opacity-75" type="button" data-bs-target="#carouselDark" data-bs-slide="next" style="width: 5vw; height: 75vh">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Next</span>
                </button>
              </div>

            </div>


            <div class="container-fluid bg-warning position-absolute bottom-0 start-50 translate-middle-x shadow-lg rounded my-1 scroll" style="height: 8vh; width:95%">
             <div class="container text-center">
                <div class="row">
                  <div class="col" id="footer">
                    <span Style="text-align: center; vertical-align: middle;line-height: 8vh;">The AirSense Project</span>
                  </div>
                  <div class="col" id="footer">
                    <span Style="text-align: center; vertical-align: middle;line-height: 8vh;">This is CS50</span>
                  </div>
                </div>
              </div></div>


        </div>





<script>
    let socket;
    const reconnectDelay = 5000; // 5 Sekunden Wartezeit für erneuten Verbindungsversuch

    function connectWebSocket() {
        // WebSocket-Verbindung aufbauen
        socket = new WebSocket(`ws://${window.location.hostname}:81`);

        // WebSocket geöffnet
        socket.onopen = () => {
            console.log("WebSocket connected");
            document.getElementById('connection').innerText = "Connected";
        };

        // Nachricht vom Server empfangen
        socket.onmessage = (event) => {
            const data = JSON.parse(event.data); // JSON-Daten parsen
            document.getElementById('humidityScd').innerText = data.humidityScd;
            document.getElementById('humidityBme').innerText = data.humidityBme;
            document.getElementById('pressure').innerText = data.bmePress;
            document.getElementById('voc').innerText = data.bmeVoc;
            document.getElementById('co2').innerText = data.co2;
            document.getElementById('pm10').innerText = data.pm10;
            document.getElementById('pm25').innerText = data.pm25;
            document.getElementById('pm100').innerText = data.pm100;
            document.getElementById('uptime').innerText = data.uptime;
            document.getElementById('tempUnitScd').innerText = String.fromCharCode(data.tempUnit);
            document.getElementById('tempUnitBme').innerText = String.fromCharCode(data.tempUnit);

            if (String.fromCharCode(data.tempUnit) == 'C') {
            document.getElementById('temperatureScd').innerText = data.temperatureScd;
            document.getElementById('temperatureBme').innerText = data.temperatureBme;
            }

            if (String.fromCharCode(data.tempUnit) == 'F') {
            document.getElementById('temperatureScd').innerText = data.temperatureScdF;
            document.getElementById('temperatureBme').innerText = data.temperatureBmeF;
            }

        };

        // WebSocket geschlossen
        socket.onclose = () => {
            console.log("WebSocket disconnected");
            document.getElementById('connection').innerText = "Disconnected";

            // Automatisch versuchen, die Verbindung nach kurzer Zeit wiederherzustellen
            console.log(`Reconnecting in ${reconnectDelay / 1000} seconds...`);
            setTimeout(connectWebSocket, reconnectDelay);
        };

        // WebSocket-Fehler
        socket.onerror = (error) => {
            console.error("WebSocket error:", error);
        };
    }

    // Initiale Verbindung aufbauen
    connectWebSocket();
</script>







        <script>
        var dataT = {
        "humidity": [45, 47, 44, 46, 48, 43, 45, 47, 44, 46, 48, 43, 45, 47, 44],
        "temperature": [22, 23, 21, 22, 24, 20, 22, 23, 21, 22, 24, 20, 22, 23, 21],
        "pressure": [1012, 1013, 1011, 1012, 1014, 1010, 1012, 1013, 1011, 1012, 1014, 1010, 1012, 1013, 1011],
        "labels":[22, 23, 21, 22, 24, 20, 22, 23, 21, 22, 24, 20, 3, 2, 1]
          };
        console.log(Object.keys(dataT)[1]);
        </script>



          <script>
          new Chart(document.getElementById("line-chart-temp"), {
            type: 'line',
            data: {
              labels: dataT['labels'],
              datasets: [{
                data: dataT['temperatureScd'],
                  label: "Sensor 1 (BME680)",
                  borderColor: "#3e95cd",
                  fill: false
                }, {
                  data: dataT['temperature'],
                  label: "Sensor 1 (BME680)",
                  borderColor: "#3e95cd",
                  fill: false,
                }, {
                  data: dataT['temperatureBme'],
                  label: "Sensor 2 (SCD30)",
                  borderColor: "#c45850",
                  fill: false
                }
              ]
            },
            options: {

            responsive: true,
            maintainAspectRatio: false,
              title: {
                display: true,
                text: 'Temperatur'
              }
            }
          });</script>

        <script>
          new Chart(document.getElementById("line-chart-hum"), {
            type: 'line',
            data: {
              labels: dataT['labels'],
              datasets: [{
                  data: dataT['humidityScd'],
                  label: "Sensor 1 (BME680)",
                  borderColor: "#3e95cd",
                  fill: false
                }, {
                  data: dataT['humidityBme'],
                  label: "Sensor 2 (SCD30)",
                  borderColor: "#c45850",
                  fill: false
                }
              ]
            },
            options: {
            responsive: true,
            maintainAspectRatio: false,
              title: {
                display: true,
                text: 'Temperatur'
              }
            }
          });</script>

<script>
  new Chart(document.getElementById("line-chart-co"), {
    type: 'line',
    data: {
      labels: dataT['labels'],
      datasets: [{
          data: dataT['temperatureScd'],
          label: "Sensor 1 (BME680)",
          borderColor: "#3e95cd",
          fill: false
        }, {
          data: dataT['humidityBme'],
          label: "Sensor 2 (SCD30)",
          borderColor: "#c45850",
          fill: false
        }
      ]
    },
    options: {
    responsive: true,
    maintainAspectRatio: false,
      title: {
        display: true,
        text: 'Temperatur'
      }
    }
  });</script>



</body>
</html>
